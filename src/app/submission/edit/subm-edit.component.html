<div class="row-offcanvas row-offcanvas-left"
     [ngClass]="{'readonly': readonly}">
    <subm-sidebar *ngIf="!readonly"
                  (toggle)="sideBarCollapsed=!sideBarCollapsed"
                  [collapsed]="sideBarCollapsed"
                  [section]="section"
                  [formControls]="formControls"
                  [errors]="errors">
    </subm-sidebar>

    <subm-navbar class="navbar-subm-fixed navbar-default"
            [ngClass]="{'collapse-left': !readonly && sideBarCollapsed}"
            [readonly]="readonly"
            [accno]="accno"
            [errors]="errors"
            [sectionPath]="sectionPath"
            (sectionClick)="onSectionClick($event)"
            (submitClick)="onSubmit($event)">
    </subm-navbar>

    <div class="container-fluid">
        <aside [ngClass]="{'collapse-left' : !readonly && sideBarCollapsed, 'right-side': !readonly}">
            <div *ngIf="subm"
                 (change)="onChange($event)"
                 class="navbar-subm-margin">

                <div *ngIf="isNew && errors.total()" class="panel">
                    <div class="panel-body">
                        <h4>New submission</h4>
                        <p>
                            Please fill out the form below. All fields are required unless marked as <i>Optional</i>. The
                            <span class="font-bold">Review</span> tab on the
                            left-hand side lists any missing or invalid information, while the
                            <span class="font-bold">Types</span> tab contains
                            optional field types that may be added to this submission.
                        </p>
                    </div>
                </div>

                <div *ngIf="!isNew && errors.total()" class="panel">
                    <div class="panel-body">
                        <h4>Incomplete submission</h4>
                        <p>
                            Some information in this submission is still missing or incorrect. Please
                            note that all fields are required unless marked as <i>Optional</i>. Check the
                            <span class="font-bold">Review</span> tab on the left-hand side for more help.
                        </p>
                    </div>
                </div>

                <div *ngIf="!errors.total() && !readonly" class="panel">
                    <div class="panel-body">
                        <h4>Study ready for submission</h4>
                        <p>
                            You may submit the data on this form now. After submission, your study will be allocated
                            a permanent accession number under which it will be published.
                        </p>
                    </div>
                </div>

                <subm-form #submForm
                           [section]="section"
                           (keyup.enter)="onSubmit($event)"
                           [readonly]="readonly">
                </subm-form>

                <div class="list-group">
                    <label class="control-label" *ngIf="section.sections.list().length > 0">Subsections</label>
                    <div *ngFor="let subsection of section.sections.list()"
                          class="list-group-item">
                        {{subsection.typeName}}
                        <span *ngIf="subsection.accno">
                            : {{subsection.accno}}
                        </span>
                        <span class="btn-toolbar pull-right">
                            <button type="button" class="section-edit btn btn-link btn-xs btn-flat"
                                    tooltip="edit"
                                    container="body"
                                    (click)="onSectionClick(subsection)">
                                <i class="fa fa-pencil fa-fw fa-lg"></i>
                            </button>
                            <button type="button" *ngIf="section.sections.isRemovable(subsection)" class="section-delete btn btn-danger btn-xs btn-flat"
                                    tooltip="delete"
                                    container="body"
                                    (click)="onSectionDelete(subsection)">
                                <i class="fa fa-trash-o fa-fw"></i>
                            </button>
                        </span>
                    </div>
                </div>

                <div *ngIf="!readonly" class="row row-submit">
                    <p class="col-md-2">
                        <button type="button" class="btn-submit btn btn-primary col-md-12"
                                [disabled]="isSubmitting || isSaving"
                                (click)="onSubmit($event)">
                            Submit
                        </button>
                    </p>
                    <p class="text-muted col-md-10">
                        <i class="fa fa-cog fa-spin" *ngIf="isSubmitting || isSaving"></i>
                        <span *ngIf="isSubmitting">Submitting study...</span>
                        <span *ngIf="isSaving">Backing up study data...</span>
                    </p>
                </div>
            </div>
        </aside>
        <confirm-dialog #confirmDialog
                        headerTitle="Delete section"
                        body="You are about to permanently delete the section"
                        confirmLabel="Delete">
        </confirm-dialog>
    </div>
</div>