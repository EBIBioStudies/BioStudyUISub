<aside class="left-side sidebar sidebar-offcanvas"
       [ngClass]="{'collapse-left' : collapsed}">
    <div class="menu-toggle">
        <button class="minimise-btn btn pull-right"
                [ngClass]="{'inactive': !collapsed}"
                [disabled]="editing"
                (click)="onToggle($event)">
            <i class="fa fa-fw fa-lg"
               [ngClass]="{'fa-toggle-left': !collapsed, 'fa-toggle-right': collapsed}"></i>
        </button>
        <tabset [ngClass]="{'invisible': collapsed}">
            <tab [active]="isStatus"
                 customClass="badge-parent"
                 (select)="onTabClick(true)">
                <template tabHeading>
                    Review
                    <span *ngIf="numInvalid" class="badge badge-corner badge-danger">{{numInvalid}}</span>
                </template>
            </tab>
            <tab heading="Types"
                 [active]="!isStatus"
                 (select)="onTabClick(false)"></tab>
        </tabset>
    </div>
    <ul class="sidebar-menu">

        <!-- Types tab -->
        <form novalidate
              [ngClass]="{'edit-type-form': editing}"
              #form="ngForm"
              (ngSubmit)="onSubmit(form)">
            <li class="sidebar-item" *ngFor="let item of items; let i = index">
                <a *ngIf="!isStatus && !editing" (click)="item.onClick($event)"
                   [tooltip]="item.label"
                   container="body">
                    <i class="fa fa-lg text-center {{item.feature.type.icon}}"></i>
                    {{!collapsed ? '&nbsp;&nbsp;Add ' + item.feature.typeName : ''}}
                </a>
                <div class="row-input"
                   [ngClass]="{'has-error': itemType.invalid && itemType.touched}"
                   *ngIf="!isStatus && editing && !item.isDeleted">
                    <label [hidden]="!itemType.errors?.unique || !itemType.touched"
                           class="control-label small">
                        Please use a unique type name
                    </label>
                    <label [hidden]="!itemType.errors?.required || !itemType.touched"
                           class="control-label small">
                        Please enter a type name
                    </label>
                    <span class="input-group">
                        <span class="input-group-addon">
                            <i class="fa fa-lg text-center {{item.feature.type.icon}}"></i>
                        </span>
                        <input type="text"
                               class="form-control input-sm form-control-auto"
                               [disabled]="item.isReadOnly()"
                               [ngModel]="item.feature.typeName"
                               name="{{item.feature.id}}"
                               #itemType="ngModel"
                               unique
                               validate-onblur
                               required />
                        <span class="input-group-btn">
                            <button class="item-delete btn btn-danger btn-sm btn-flat"
                                    [disabled]="item.isReadOnly()"
                                    tooltip="delete"
                                    (click)="onItemDelete($event, item.feature.id, form.controls, i)">
                                <i class="fa fa-trash-o fa-fw"></i>
                            </button>
                        </span>
                    </span>
                </div>
            </li>
            <li *ngIf="!isStatus && editing && !collapsed" class="row-submit btn-toolbar">
                <button class="btn btn-primary btn-submit" type="submit">
                    Save
                </button>
                <button class="btn btn-default btn-cancel"(click)="onCancel($event)">
                    Cancel
                </button>
            </li>
        </form>
        <li  *ngIf="!isStatus && !editing" class="sidebar-item type-control">
            <a (click)="onEditModeToggle($event)">
                <strong class="fa-stack">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-pencil fa-stack-1x fa-inverse"></i>
                </strong>
                {{!collapsed ? '&nbsp;Edit types' : ''}}
            </a>
        </li>
        <li *ngIf="!isStatus && !editing" class="sidebar-item type-control">
            <a (click)="onAddClick($event)">
                <i class="fa fa-fw fa-plus-circle fa-lg"></i>
                {{!collapsed ? '&nbsp;&nbsp;New type' : ''}}
            </a>
        </li>

        <!-- Review tab -->
        <div *ngIf="isStatus">
            <li *ngIf="errors.empty()" class="no-error-msg text-center"
                [ngClass]="{'col-md-12': !collapsed}">
                <i class="fa fa-check-circle" aria-hidden="true"
                    [ngClass]="{'fa-2x': collapsed, 'fa-4x': !collapsed}"></i>
                <h4>All fields are valid</h4>
            </li>
            <li class="sidebar-item" *ngFor="let control of formControls; let i = index">
                <a *ngIf="control.invalid"
                   tooltip="{{collapsed ? tipText(control.errors) : ''}}"
                   container="body"
                   placement="right"
                   (click)="onReviewClick(control)">
                    <i class="fa fa-lg text-center {{control.parentType.icon}}"></i>
                    {{!collapsed ? '&nbsp;' + control.template.name + '&nbsp;' : ''}}
                    <strong class="label label-default"
                            [ngClass]="{'label-danger': control.invalid && control.touched}"
                            #labelEl>
                        {{!collapsed ? tipText(control.errors) : ''}}
                        <i *ngIf="collapsed && control.errors.required" class="fa fa-lg fa-asterisk"></i>
                        <i *ngIf="collapsed && (control.errors.maxlength || control.errors.minlength)" class="fa fa-lg fa-arrows-h"></i>
                    </strong>
                </a>
            </li>
        </div>
    </ul>
</aside>
<subm-add-dialog #addDialog
                [onAddType]="onAdd.bind(this)">
</subm-add-dialog>
<confirm-dialog #confirmDialog
                headerTitle="Delete items"
                confirmLabel="Delete">
</confirm-dialog>