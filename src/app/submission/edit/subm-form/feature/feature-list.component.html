<div class="container-fluid" [formGroup]="featureForm.form">
    <div class="headings row text-muted">
        <div class="cell heading col-xs-3">Key</div>
        <div class="cell heading col-xs-9">Value</div>
    </div>
    <div class="row" #rowEl *ngFor="let column of columns; let idx = index; let first = first; let last = last">
        <div class="cell col-xs-3">
            <div class="form-group key-field">
                <div class="input-group">
                    <span *ngIf="!readonly && !column.required" class="input-group-btn">
                          <button type="button" tabindex="-1"
                                  class="btn btn-sm btn-danger btn-flat"
                                  (click)="featureForm.feature.removeRowAt(idx)"
                                  [disabled]="!feature.canRemoveRowAt(idx)"
                                  [tooltip]="'Delete ' + feature.typeName.toLowerCase() + ' entry'">
                               <i class="fa fa-trash-o"></i>
                          </button>
                    </span>
                    <input type="text"
                           class="form-control input-sm"
                           [readonly]="readonly"
                           [(ngModel)]="column.name"
                           [formControl]="featureForm.columnControl(column.id)"
                           [readonly]="column.required || readonly"
                           (blur)="featureForm.columnControl(column.id).value ||
                                   featureForm.columnControl(column.id).setValue(feature.typeName + ' ' + (idx + 1))">
                </div>
            </div>
        </div>
        <div class="cell col-xs-9">
            <div class="form-group"
                 [ngClass]="{'has-error': featureForm.rowValueControl(0,column.id).invalid &&
                                          featureForm.rowValueControl(0,column.id).touched}">
                <subm-field placement="{{first && !last ? 'bottom' : 'top'}}"
                            triggers="focus"
                            containerClass="validation-pop text-danger"
                            popover="{{featureForm.rowErrors[0][column.id]}}"
                            [type]="column.valueType"
                            [(ngModel)]="feature.rows[0].valueFor(column.id).value"
                            [readonly]="readonly"
                            isSmall="true"
                            [formControl]="featureForm.rowValueControl(0,column.id)"
                            validate-onblur>
                </subm-field>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-1 col-md-1">
        <button *ngIf="!readonly"
                type="button"
                class="btn-add btn btn-link"
                [tooltip]="'Add a new ' + feature.typeName.toLowerCase()"
                (click)="feature.addColumn()">
            <i class="fa fa-lg {{feature.type.icon}}"></i>
            &nbsp;Add {{feature.typeName.toLowerCase()}} row
        </button>
    </div>
</div>