<div class="form-horizontal container-fluid" [formGroup]="featureForm.form">
    <div class="headings row text-muted">
        <div class="cell heading col-xs-3">Key</div>
        <div class="cell heading col-xs-9">Value</div>
    </div>
    <div *ngFor="let column of columns; let idx = index; let first = first; let last = last">
        <div class="row" #rowEl *ngIf="!readonly || feature.rows[0].valueFor(column.id).value.length">
            <div class="cell col-xs-3">
                <div class="form-group key-field"
                     [ngClass]="{'optional': column.removable && !isColUIReq(column),
                                 'has-error': !column.required &&
                                              featureForm.columnControl(column.id).invalid &&
                                              featureForm.columnControl(column.id).touched}">
                    <div [ngClass]="{'input-group': column.removable && !isColUIReq(column), 'readonly': column.readonly}">
                        <span *ngIf="column.removable && !isColUIReq(column)" class="input-group-btn"
                              container="body"
                              [tooltip]="feature.canRemoveRowAt(index) ? '' : 'The list must contain one entry at least'">
                              <button type="button" tabindex="-1"
                                      class="btn btn-sm btn-danger btn-flat"
                                      (click)="feature.removeRowAt(idx)"
                                      [disabled]="!feature.canRemoveRowAt(idx)"
                                      [tooltip]="feature.canRemoveRowAt(idx) ? 'Delete &quot;' + column.name + '&quot; entry' : ''"
                                      placement="bottom"
                                      container="body">
                                   <i class="fa fa-trash-o"></i>
                              </button>
                        </span>
                        <input type="text" class="form-control input-sm"
                               placement="top"
                               triggers="focus"
                               container="body"
                               containerClass="text-danger"
                               popover="{{featureForm.columnControl(column.id).invalid &&
                                          featureForm.columnControl(column.id).touched ? 'Please use a unique key name' : ''}}"
                               [formControl]="featureForm.columnControl(column.id)"
                               [readonly]="isColUIReq(column) || column.displayed"
                               [typeahead]="isColUIReq(column) || column.displayed ? [] : colNames"
                               [typeaheadMinLength]="0"
                               [typeaheadOptionsLimit]="200"
                               [typeaheadScrollable]="true"
                               [typeaheadOptionsInScrollableView]="suggestLength"
                               #ahead="bs-typeahead"
                               [unique]="feature.uniqueCols"
                               validate-onblur
                               (keyup.enter)="ahead._container ? $event.stopPropagation() : return"
                               (change)="onFieldChange(column, $event.target.value, 'name')"
                               (typeaheadOnSelect)="onSuggestSelect($event, column)"
                               (blur)="featureForm.columnControl(column.id).value ||
                                       featureForm.columnControl(column.id).setValue(feature.typeName + ' ' + (idx + 1))">
                    </div>
                </div>
            </div>
            <div class="cell col-xs-9">
                <div class="form-group"
                     [ngClass]="{'readonly': column.readonly,
                                 'optional': !isColUIReq(column),
                                 'has-warning': !featureForm.feature.type.required &&
                                                featureForm.rowValueControl(0,column.id).invalid &&
                                                featureForm.rowValueControl(0,column.id).touched,
                                 'has-error': featureForm.feature.type.required &&
                                              featureForm.rowValueControl(0,column.id).invalid &&
                                              featureForm.rowValueControl(0,column.id).touched}">
                    <subm-field placement="top"
                                triggers="focus"
                                container="body"
                                containerClass="{{featureForm.feature.type.required ? 'text-danger' : 'text-warning'}}"
                                popover="{{featureForm.rowValueControl(0, column.id).invalid &&
                                           featureForm.rowValueControl(0, column.id).touched ? featureForm.rowErrors[0][column.id] : ''}}"
                                (ngModelChange)="onFieldChange(feature.rows[0].valueFor(column.id), $event)"
                                [type]="column.valueType"
                                [readonly]="readonly || column.readonly"
                                [required]="column.required"
                                [formControl]="featureForm.rowValueControl(0,column.id)"
                                [allowPast]="column.allowPast"
                                [autosuggest]="column.values"
                                validate-onblur>
                    </subm-field>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="row">
    <div class="col-xs-1 col-md-1">
        <button *ngIf="!readonly"
                type="button"
                class="btn-add btn btn-link"
                [tooltip]="'Add a new ' + feature.typeName.toLowerCase()"
                container="body"
                (click)="feature.addColumn()">
            <i class="fa fa-lg fa-plus-circle"></i>
            Add {{feature.typeName.toLowerCase()}} row
        </button>
    </div>
</div>