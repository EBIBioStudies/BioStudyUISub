<uib-tabset>
    <uib-tab heading="{{dict.previewTabHeading}}">
        <div class="table-responsive">
            <table class="table table-condensed" style="width:100%">
                <thead>
                <th></th>
                <th></th>
                <th ng-repeat="field in dict.fields" class="">
                    <span class="text-muted has-error error">{{field.label}}</span>
                </th>
                <th ng-repeat="key in attributeKeys" class="">
                    <span class="text-muted has-error error">{{key}}</span>
                </th>
                </thead>

                <tbody ng-form="previewItemForm">
                <tr ng-repeat="item in data.items">
                    <td>
                        {{$index+1}}
                    </td>
                    <td>
                        <button type="button"
                                class="btn btn-primary btn-sm"
                                ng-click="data.ui.activeTabs[$index]=true"
                                uib-tooltip={{dict.actions.edit.popup}}>
                            <i class="fa fa-edit"></i></button>
                        <button type="button"  ng-if="!readOnly"
                                class="btn btn-warning btn-sm"
                                ng-click="data.remove($index, item)"
                                uib-tooltip={{dict.actions.delete.popup}}>
                            <i class="fa fa-trash"></i></button>
                    </td>
                    <td ng-repeat="key in attributeKeys" class="form-group-sm row" ng-class="colSizeCss">
                        <div ng-repeat="attr in item.attributes.attributes | filter:{ name: key }"
                             ng-class="{'has-error' : previewItemForm['attrValuePreview_' + key].$invalid}">
                            <input type="text" name="attrValuePreview_{{key}}" ng-model="attr.value"
                                   class="form-control input-sm form-control-auto" placeholder="Enter a value"
                                   ng-if="attr.type === 'text'"
                                   uib-typeahead="value for value in typeaheadValues(attr.name, item.$index) | filter:$viewValue:$emptyOrMatch | limitTo:10"
                                   typeahead-append-to-body="true"
                                   typeahead-show-hint="true"
                                   typeahead-min-length="0"
                                   uib-tooltip="This field is required"
                                   tooltip-class="customClass"
                                   tooltip-placement="top-left"
                                   tooltip-enable="previewItemForm['attrValuePreview_' + key].$invalid"
                                   ng-required="attr.required"
                                   ng-change="onAttributeChange()"
                                   ng-readonly="readOnly"
                                   ng-model-options="{ allowInvalid: true }">

                            <div ng-controller="FileCtrl" ng-if="attr.type === 'file'">
                                <select class="form-control"
                                        ng-model="attr.value"
                                        ng-change="onAttributeChange()"
                                        name="attrValuePreview_{{key}}"
                                        ng-required="attr.required"
                                        ng-if="files.length">
                                    <option ng-repeat="file in files" value="{{file}}">
                                        {{file}}
                                    </option>
                                </select>
                                <a ui-sref="files({ bb:1 })"
                                   class="btn btn-link"
                                   ng-if="!files.length">Go to File Upload</a>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </uib-tab>

    <uib-tab ng-repeat="item in data.items" active="data.ui.activeTabs[$index]" ng-form name="itemForm">
        <uib-tab-heading ng-class="{'text-danger': authorForm.$invalid}">
            {{dict.tabHeading + ($index+1)}}
        </uib-tab-heading>
        <p class="pull-right padding-right-small padding-top-small">
            <button type="button"
                    class="pull-right btn btn-danger btn-xs"
                    ng-click="data.remove($index, item);"
                    uib-tooltip={{dict.actions.delete.popup}}
                    tooltip-placement="bottom"
                    ng-if="!readOnly"><i class="fa fa-lg fa-trash"></i>
            </button>
        </p>

        <bs-section-item data-ng-model="item"
                         data-type="{{dataType}}"
                         data-change="onAttributeChange()">
        </bs-section-item>
    </uib-tab>

</uib-tabset>


